<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='icon' href='favicon.ico' type='image/x-icon'/ >
    <title>WFH Guide</title>
    <style>
      @import url('https://fonts.googleapis.com/css?family=Quicksand:400,500,700&subset=latin-ext');
      * {
        box-sizing: border-box;
      }
      html {
        height:100%;
      }
      
      body {
        min-height: 100%;
        font-family: 'Quicksand', sans-serif;
        margin: 0;
        background: #36d1dc;
        /* fallback for old browsers */
        background: -webkit-linear-gradient(to right, #36d1dc, #5b86e5);
        /* Chrome 10-25, Safari 5.1-6 */
        background: linear-gradient(to right, #36d1dc, #5b86e5);
        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        text-align: center;
      }
      .card {
        display: inline-block;
        width: 350px;
        min-height: 460px;
        margin: 50px 30px;
        box-shadow: 0px 8px 60px -10px rgba(13, 28, 39, 0.6);
        background: #fff;
        border-radius: 12px;
        max-width: 700px;
        padding: 15px;
        position: relative;
      }
      .card__img {
        width: 150px;
        height: 150px;
        margin-left: auto;
        margin-right: auto;
        transform: translateY(-50%);
        border-radius: 50%;
        overflow: hidden;
        position: relative;
        z-index: 4;
      }
      .card__img img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }
      .card__title {
        margin-top: -35px;
        text-align: center;
        padding: 0 20px;
        padding-bottom: 5px;
        transition: all 0.3s;
        font-size: 20px;
        min-height: 15px;
        max-height: 40px;
      }
      .card__description {
        font-size: 16px;
        font-weight: 500;
        color: #324e63;
        margin-bottom: 15px;
        min-height: 200px;
        max-height: 200px;
        margin-top: 60px;
      }
      .card__button {
        background: none;
        border: none;
        font-family: 'Quicksand', sans-serif;
        font-weight: 700;
        font-size: 19px;
        margin: 15px 35px;
        padding: 15px 40px;
        min-width: 201px;
        border-radius: 50px;
        min-height: 55px;
        color: #fff;
        cursor: pointer;
        backface-visibility: hidden;
        transition: all 0.3s;
      }
      .search-grid {
        padding-bottom: 10px;
        text-align: center;
        width: 100%;
        /* max-width: 1140px; */
        /* min-width: 748px; */
        margin: 50px 0px;
        overflow: hidden;
      }
      .search-grid .searchbox {
        padding: 0 12%;
        width: 100%;
        float: left;
        /*min-height: 1px;*/
        /*padding-right: 20px;*/
      }
      .search-grid input[type="text"] {
        width: 50%;
        padding: 0px 20px;
        line-height: 40px;
        border-radius: 20px;
        background-color: #FAFAFA;
        border: 1px solid #AF3F3E;
        outline: none;
        color: #4a4a4a;
        font-size: 1rem;
      }

      .permalink {
        background-image: url(linkto.png);
        width: 27px;
        height: 27px;
        float: left;
        background-repeat: no-repeat;
        position: absolute;
        right: 20px;
        cursor: pointer;
      }

      /* Keep media CSS below to override for devices */
      /* ============================================ */
      @media screen and (max-width: 768px) {
        .card__button {
          min-width: 170px;
          margin: 15px 25px;
        }
      }
      @media screen and (max-width: 576px) {
        .search-grid input[type="text"] {
          width: 100%;
        }
        .card__button {
          min-width: inherit;
          margin: 10px;
          margin-bottom: 16px;
          width: 100%;
          max-width: 300px;
        }
        .card__button:last-child {
          margin-bottom: 0;
        }
      }
      .card__button:focus {
        outline: none !important;
      }
      @media screen and (min-width: 768px) {
        .card__button:hover {
          transform: translateY(-5px);
        }
      }
      .card__button.button--blue {
        background: linear-gradient(45deg, #1da1f2, #0e71c8);
        box-shadow: 0px 4px 30px rgba(19, 127, 212, 0.4);
      }
      .card__button.button--blue:hover {
        box-shadow: 0px 7px 30px rgba(19, 127, 212, 0.75);
      }
      .card__button.button--orange {
        background: linear-gradient(45deg, #d5135a, #f05924);
        box-shadow: 0px 4px 30px rgba(223, 45, 70, 0.35);
      }
      .card__button.button--orange:hover {
        box-shadow: 0px 7px 30px rgba(223, 45, 70, 0.75);
      }
      a {
        text-decoration:none;
        color: white;
      }
      .brand {
        font-size: 4.5rem;
        font-weight: 800;
        text-shadow: 0px 1px 2px rgba(72, 45, 38, 0.5);
        letter-spacing: -1px;
        color: white;
        /*font-family: 'Whitney SSm A', 'Whitney SSm B', 'Whitney';*/
      }
      header {
        margin-bottom: 70px;
      }
      .text-center {
        text-align: center;
      }

      /* POPUP related stuff : Keep below this line */
      /* Popup container */
      .popup {
        display: inline-block;
        cursor: pointer;
      }

      /* The actual popup (appears on top) */
      .popup .popuptext {
        visibility: hidden;
        width: 160px;
        background-color: #555;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 8px 0;
        position: absolute;
        z-index: 99;
        bottom: 125%;
        left: 50%;
        margin-left: -80px;
      }

      /* Popup arrow */
      .popup .popuptext::after {
        content: "";
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #555 transparent transparent transparent;
      }

      /* Toggle this class when clicking on the popup container (hide and show the popup) */
      .popup .show {
        visibility: visible;
        -webkit-animation: fadeIn 1s;
        animation: fadeIn 1s
      }

      .popup .hide {
        visibility: hidden;
      }

      /* Add animation (fade in the popup) */
      @-webkit-keyframes fadeIn {
        from {opacity: 0;}
        to {opacity: 1;}
      }

      @keyframes fadeIn {
        from {opacity: 0;}
        to {opacity:1 ;}
      }
    </style>
    
    <meta name="description" content="You'll find the best of the internet's wisdom to make your attempt at working from home successful as we weather the Covid-19 storm, "/>
    <meta name="title" content="The best of the internet about working from home." />
    <meta name="google-site-verification" content="Z9BAIb9TB968b-KIBim8TFIR7fmsjcZriGROfipAtac" />
    <script src="https://unpkg.com/lunr/lunr.js"></script>
</head>

<body>

  <div class='text-center'>
    <h1 class='brand'>
      WFH.guide
    </h1>
    <h4>
      Top picks for remote work from the wisdom of the internet!
    </h4>
    <h4>
      Something we should add? Tweet to us at <a target="_blank" href="https://twitter.com/wfh_guide"> @wfh_guide </a>
    </h4>
  </div>

  <!-- Search Bar -->
  <div class='search-grid'>
    <div class='searchbox'>
      <input type="text" id="searchbar" placeholder="Search for wfh, slack, +postman, etc."/>
    </div>
  </div>

  <div id='content'>
  </div>

  <footer>
    <hr/>
    <h4>
      Made with ❤️ from Chennai!
    </h4>
  </footer>

  <script>
    var parsed_data = {}, contenthtml = "", idx=null;
    jQuery.ajax({
      url: "https://csv-to-json.herokuapp.com/?csv=https://docs.google.com/spreadsheets/d/1-K3OvM4xoXHz95jyl_pscnMgXNesgx2t6-9nXlYkfN0/pub?output=csv",
      success: function(data){
        
        //-- Construct cards and rendering them
        jQuery.each(data, function(i, ele){
          parsed_data[i] = ele;
          parsed_data[i]['Id'] = i;
          contenthtml += constructCard(ele);
        });
        renderCards(contenthtml)

        //-- Adding search index
        idx = lunr(function () {
          this.use(normaliseSpelling)

          this.ref('Id')
          this.field('Title')
          this.field('Description')
          Object.values(parsed_data).forEach(function (doc) {
            this.add(doc)
          }, this)
        });
      }
    });

    function constructCard(ele) {
      return "<div id=\"card-" + MD5(ele.Title) + "\" class=\"card\">" + 
        "<a class='permalink popup' onclick=\"onPermalinkClick(event, this, 'card-"+MD5(ele.Title)+"')\" href='#'><span class='popuptext' id='myPopup'>Permalink copied!</span></a>" +
        "<div class=\"card__img\"><img src=\"" + ele.LogoLink + "\"/></div>" +
        "<h3 class=\"card__title\">" + ele.Title + "</h3>" + 
        "<p class=\"card__description\">" + ele.Description + "</p>" + 
        "<a target=\"_blank\" href=\"" + ele.Link + "\">" + 
          "<div class=\"card__button button--orange\">Read " + ele.Type + "</div></a>" + 
      "</div>";
    }

    function renderCards(contenthtml) {
      jQuery('.card').remove();
      jQuery('#content').append(contenthtml);
    }

    var normaliseSpelling = function (builder) {

      // Define a pipeline function that remove 's
      var pipelineFunction = function (token) {
        var tokenStr = token.toString()
        if (tokenStr.endsWith("'s")) {
          return token.update(function () { return tokenStr.slice(0, tokenStr.length-2) })
        } else {
          return token
        }
      }

      // Register the pipeline function so the index can be serialised
      lunr.Pipeline.registerFunction(pipelineFunction, 'normaliseSpelling')

      // Add the pipeline function to both the indexing pipeline and the
      // searching pipeline
      builder.pipeline.before(lunr.stemmer, pipelineFunction)
      builder.searchPipeline.before(lunr.stemmer, pipelineFunction)
    }

    //-- Delay for keyup
    function delay(callback, ms) {
      var timer = 0;
      return function() {
        var context = this, args = arguments;
        clearTimeout(timer);
        timer = setTimeout(function () {
          callback.apply(context, args);
        }, ms || 0);
      };
    }

    //-- MD5 hashing of URLs for permalink
    var MD5 = function(d){var r = M(V(Y(X(d),8*d.length)));return r.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}

    function onPermalinkClick(event, _this, permaId) {
      event.preventDefault();
      event.stopPropagation();

      var el = document.createElement('textarea');
      el.value = window.location.href + '#' + permaId;
      document.body.appendChild(el);
      el.select();
      document.execCommand('copy');
      document.body.removeChild(el);

      _this.children[0].classList.toggle("show");
      setTimeout(function(){ _this.children[0].classList.toggle("hide"); }, 2000);
    }

    jQuery(document).ready(function(){

      //-- Search on keyup
      jQuery('#searchbar').keyup(delay(function(ev){
        var searchterm = jQuery(this).val();
        if(searchterm != "") {
          matches = idx.search(searchterm);

          var chtml = "";
          matches.forEach(function(doc) {
            chtml += constructCard(parsed_data[doc.ref]);
          });
          // console.log(chtml);
          renderCards(chtml);
        } else {
          var chtml = "";
          Object.values(parsed_data).forEach(function(doc) {
            chtml += constructCard(doc);
          });
          // console.log(chtml);
          renderCards(chtml);
        }
      }, 500));
    });
  </script>
</body>
</html>
